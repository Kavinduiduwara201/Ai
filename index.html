<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Register + Login + AI Chatbot</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
html, body {
  margin: 0; padding: 0; height: 100%;
  font-family: 'Inter', sans-serif;
  background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
  background-size: cover;
  display: flex; justify-content: center; align-items: center;
  overflow: hidden;
}

/* Clear Data & Toggle buttons */
#clearStorageBtn, #toggleOverlayBtn {
  position: fixed;
  top: 10px;
  padding: 8px 12px;
  font-weight: 600;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  box-shadow: 0 0 8px rgba(0,0,0,0.3);
  background: #5c12ff;
  color: white;
  user-select: none;
  z-index: 10000;
  transition: background 0.3s;
}
#clearStorageBtn:hover, #toggleOverlayBtn:hover {
  background: #4800ff;
}
#clearStorageBtn { right: 10px; }
#toggleOverlayBtn { right: 140px; }

/* Overlays */
.overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.7);
  display: flex; justify-content: center; align-items: center;
  z-index: 999;
}
.form-box {
  background: white;
  border-radius: 20px;
  padding: 24px 32px;
  width: 320px;
  box-shadow: 0 0 40px #5c12ffaa;
  display: flex; flex-direction: column; gap: 16px;
}
.form-box h2 {
  margin: 0 0 8px;
  text-align: center;
  color: #5c12ff;
}
.form-box input {
  padding: 10px 14px;
  border-radius: 12px;
  border: 1.5px solid #5c12ff;
  font-size: 1rem;
}
.form-box button {
  padding: 12px;
  background: #5c12ff;
  color: white; font-weight: 700; font-size: 1.1rem;
  border: none; border-radius: 12px; cursor: pointer;
  transition: background 0.3s;
}
.form-box button:hover {
  background: #4800ff;
}

/* Chat container */
.chat-container {
  display: none;
  width: 360px; height: 600px;
  flex-direction: column;
  border-radius: 20px;
  background: white;
  box-shadow: 0 0 40px #5c12ffaa;
  overflow: hidden;
}

/* Header with gradient */
.chat-header {
  background: linear-gradient(135deg, #4800ff, #0093ff);
  padding: 12px 16px;
  color: white; font-weight: 600; font-size: 1.25rem;
  display: flex; align-items: center; gap: 10px;
  position: relative;
}
.chat-header img {
  width: 28px; height: 28px;
}
.chat-header #logoutBtn {
  position: absolute; right: 12px; top: 50%;
  transform: translateY(-50%);
  cursor: pointer; font-size: 0.9rem;
  background: rgba(255,255,255,0.2);
  padding: 4px 8px; border-radius: 6px;
  user-select: none;
}

/* Messages */
.chat-messages {
  flex: 1; padding: 12px; overflow-y: auto;
  background: #f7f7f7;
  display: flex; flex-direction: column; gap: 12px;
}
.message {
  display: flex; align-items: flex-end; gap: 8px; max-width: 80%;
}
.message.user {
  align-self: flex-end;
  flex-direction: row-reverse;
}
.message.user .bubble {
  background: #5c12ff; color: white;
}
.message.bot .bubble {
  background: #fff; color: black; border: 1px solid #ccc;
}
.bubble {
  padding: 8px 14px; border-radius: 18px;
  font-size: 0.95rem; line-height: 1.3;
}
.message img {
  width: 32px; height: 32px; border-radius: 50%;
  user-select: none;
}

/* Input */
.chat-input {
  display: flex; align-items: center;
  background: #5c12ff;
  padding: 10px;
}
.chat-input input {
  flex: 1; border: none; outline: none;
  background: transparent; color: white;
  font-size: 1rem;
}
.chat-input input::placeholder {
  color: rgba(255,255,255,0.7);
}
.send-btn {
  background: transparent; border: none; cursor: pointer;
}
.send-btn svg {
  width: 28px; height: 28px; fill: gold;
}
.send-btn:disabled svg {
  opacity: 0.4; cursor: not-allowed;
}

/* Scrollbar styling */
.chat-messages::-webkit-scrollbar {
  width: 8px;
}
.chat-messages::-webkit-scrollbar-thumb {
  background: #5c12ffaa;
  border-radius: 4px;
}
.chat-messages::-webkit-scrollbar-track {
  background: #f7f7f7;
}
</style>
</head>
<body>

<!-- Background Audio -->
<audio id="bgAudio" src="https://files.catbox.moe/ypnd2c.mp3" autoplay loop muted></audio>

<!-- Clear data and toggle buttons -->
<button id="clearStorageBtn" title="Clear registration data">Clear Data</button>
<button id="toggleOverlayBtn" title="Toggle Register/Login Overlay">Toggle Register/Login</button>

<!-- Register -->
<div id="registerOverlay" class="overlay" style="display:flex;">
  <form id="registerForm" class="form-box" autocomplete="off">
    <h2>Register</h2>
    <input type="text" id="regName" placeholder="Name" required autocomplete="name" />
    <input type="email" id="regEmail" placeholder="Email" required autocomplete="email" />
    <input type="tel" id="regNumber" placeholder="Number" required autocomplete="tel" />
    <button type="submit">Register</button>
  </form>
</div>

<!-- Login -->
<div id="loginOverlay" class="overlay" style="display:none;">
  <form id="loginForm" class="form-box" autocomplete="off">
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email" required autocomplete="email" />
    <input type="tel" id="loginNumber" placeholder="Number" required autocomplete="tel" />
    <button type="submit">Login</button>
  </form>
</div>

<!-- Chat -->
<div class="chat-container" id="chatContainer" role="region" aria-label="Chatbot window">
  <div class="chat-header">
    <img src="https://cdn-icons-png.flaticon.com/512/4712/4712027.png" alt="Chatbot Icon" />
    Chatbot
    <div id="logoutBtn" tabindex="0" role="button" aria-label="Logout">Logout</div>
  </div>
  <div class="chat-messages" id="chatMessages" aria-live="polite" aria-relevant="additions"></div>
  <form id="chatForm" class="chat-input" autocomplete="off" aria-label="Send message form">
    <input type="text" id="userInput" placeholder="Type here..." required aria-required="true" />
    <button type="submit" class="send-btn" disabled aria-disabled="true" aria-label="Send message">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M2 21l21-9L2 3v7l15 2-15 2z"/>
      </svg>
    </button>
  </form>
</div>

<script>
  // Replace these with your keys before running
  const BOT_TOKEN = '8266023841:AAF7WQf-CngjP6KVcBJS7AeJ8WdcSYxlA5I';
  const CHAT_ID = '1720283336';
  const OPENAI_API_KEY = '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';

  // Elements
  const registerOverlay = document.getElementById('registerOverlay');
  const loginOverlay = document.getElementById('loginOverlay');
  const chatContainer = document.getElementById('chatContainer');
  const logoutBtn = document.getElementById('logoutBtn');
  const chatMessages = document.getElementById('chatMessages');
  const userInput = document.getElementById('userInput');
  const chatForm = document.getElementById('chatForm');
  const clearStorageBtn = document.getElementById('clearStorageBtn');
  const toggleOverlayBtn = document.getElementById('toggleOverlayBtn');

  // On load - decide what overlay to show
  if (localStorage.getItem('registeredUser')) {
    registerOverlay.style.display = 'none';
    loginOverlay.style.display = 'flex';
  } else {
    registerOverlay.style.display = 'flex';
    loginOverlay.style.display = 'none';
  }

  // Register form submit
  document.getElementById('registerForm').addEventListener('submit', async e => {
    e.preventDefault();

    const name = document.getElementById('regName').value.trim();
    const email = document.getElementById('regEmail').value.trim();
    const number = document.getElementById('regNumber').value.trim();

    if (!name || !email || !number) {
      alert('Please fill all fields');
      return;
    }

    localStorage.setItem('registeredUser', JSON.stringify({ name, email, number }));

    try {
      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          chat_id: CHAT_ID,
          text: `New Registration:\nName: ${name}\nEmail: ${email}\nNumber: ${number}`
        })
      });
      alert('Registered successfully! Please login.');
      registerOverlay.style.display = 'none';
      loginOverlay.style.display = 'flex';
    } catch (error) {
      alert('Error sending registration info to Telegram. Check your bot token and chat ID.');
      console.error(error);
    }
  });

  // Login form submit
  document.getElementById('loginForm').addEventListener('submit', e => {
    e.preventDefault();

    const email = document.getElementById('loginEmail').value.trim();
    const number = document.getElementById('loginNumber').value.trim();

    const savedUser = JSON.parse(localStorage.getItem('registeredUser') || '{}');

    if (savedUser.email === email && savedUser.number === number) {
      loginOverlay.style.display = 'none';
      chatContainer.style.display = 'flex';
      appendMessage('bot', `Welcome, ${savedUser.name}!`);
    } else {
      alert('Invalid login credentials.');
    }
  });

  // Logout
  logoutBtn.addEventListener('click', () => {
    chatContainer.style.display = 'none';
    loginOverlay.style.display = 'flex';
    chatMessages.innerHTML = '';
    conversation = [];
  });
  logoutBtn.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' || e.key === ' ') logoutBtn.click();
  });

  // Chat logic
  let conversation = [];

  // Enable/disable send button on input
  userInput.addEventListener('input', () => {
    const btn = document.querySelector('.send-btn');
    const hasText = userInput.value.trim().length > 0;
    btn.disabled = !hasText;
    btn.setAttribute('aria-disabled', !hasText);
  });

  chatForm.addEventListener('submit', async e => {
    e.preventDefault();
    const text = userInput.value.trim();
    if (!text) return;

    appendMessage('user', text);
    conversation.push({ role: 'user', content: text });

    userInput.value = '';
    const btn = document.querySelector('.send-btn');
    btn.disabled = true;
    btn.setAttribute('aria-disabled', 'true');

    appendMessage('bot', 'Typing...');

    try {
      const reply = await getGPT(conversation);
      // Remove the "Typing..." message
      const bots = Array.from(document.querySelectorAll('.message.bot'));
      if (bots.length) bots[bots.length - 1].remove();

      appendMessage('bot', reply);
      conversation.push({ role: 'assistant', content: reply });
    } catch (err) {
      console.error(err);
      const bots = Array.from(document.querySelectorAll('.message.bot'));
      if (bots.length) bots[bots.length - 1].remove();
      appendMessage('bot', 'Sorry, something went wrong. Try again.');
    }
  });

  // Append message function
  function appendMessage(who, text) {
    const msg = document.createElement('div');
    msg.className = `message ${who}`;
    const avatar = who === 'user'
      ? '<img src="https://files.catbox.moe/htvxtq.jpg" alt="User avatar" />'
      : '<img src="https://cdn-icons-png.flaticon.com/512/4712/4712027.png" alt="Bot avatar" />';
    msg.innerHTML = `${avatar}<div class="bubble">${text}</div>`;
    chatMessages.appendChild(msg);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  // OpenAI Chat API call
  async function getGPT(messages) {
    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${OPENAI_API_KEY}`
      },
      body: JSON.stringify({
        model: 'gpt-4o-mini',
        messages: messages
      })
    });
    if (!response.ok) {
      throw new Error(`OpenAI API error: ${response.statusText}`);
    }
    const data = await response.json();
    return data.choices[0].message.content.trim();
  }

  // Clear localStorage & reload
  clearStorageBtn.addEventListener('click', () => {
    if(confirm('Clear all registration data?')) {
      localStorage.removeItem('registeredUser');
      location.reload();
    }
  });

  // Toggle Register/Login overlays (for testing)
  toggleOverlayBtn.addEventListener('click', () => {
    if(registerOverlay.style.display === 'flex') {
      registerOverlay.style.display = 'none';
      loginOverlay.style.display = 'flex';
    } else {
      registerOverlay.style.display = 'flex';
      loginOverlay.style.display = 'none';
    }
  });
</script>

</body>
</html>
